Ext.define('epl.system.view.MenuNodeTree',{     extend: 'Ext.tree.Panel',     alias: 'widget.system.menuNodeTree',    requires:['epl.system.store.MenuStore'],         initComponent : function(){         Ext.apply(this,{             id: 'menu-nodePanel',             title: '菜单管理',             iconCls:'icon-menu',             region:'west',             enableDD : false,             split: true, //            minSize : 130, //            maxSize : 300,             rootVisible: false, //            containerScroll : true,             autoScroll:true,            store:Ext.create('epl.system.store.MenuStore'),            dockedItems:[{              xtype:'toolbar',              dock: 'bottom',              items:["->",{                xtype: 'tbtext',text: '使用右键菜单新增或删除菜单'              }]            }],            viewConfig:{              plugins:{  // 拖拽插件                ptype:'treeviewdragdrop'              },              listeners:{                beforedrop:function(node,data,overModel,dropPosition,dropFunction,options ){//                  if(data.records[0].data.type!='1'){//                    alert(data.records[0].data.type);//                    Ext.Msg.alert('提示','报表类别不能拖动！');//                    return false;//                  }else{                    var tarNode = data.view.getRecord(node);                    var obj = Ext.Ajax.request({                    url: 'system/SysManage/dragMenu.htm', // +'/report_ExtReport_dragReport.htm',                    params:{sid:data.records[0].data.sid,target:tarNode.data.sid,targetType:tarNode.data.type,dropPosition:dropPosition},                    callback:function(options,success,response){                      if(success){                        var r = Ext.JSON.decode(response.responseText);                        Ext.Msg.alert('提示',r.msg);                        if(r.success){//                          if(r.sid==Ext.getCmp('sid').getValue()){//                            Ext.getCmp('sysReportType_sid').setValue(r.type_id);//                            Ext.getCmp('sysReportType_name').setValue(r.type_name);//                            Ext.getCmp('postion').setValue(r.postion);//                          }                          if(dropPosition=='append'){//排序                            tarNode.sort(mysort);                          }else{                            tarNode.parentNode.sort(mysort);                          }                        }else{                          return false;                        }                      }else{                        Ext.Msg.alert("提示","请求出错，拖动结果未保存！请重新刷新页面。");                        return false;                      }                    }                  });//                  }                }              }            }        });         this.callParent(arguments);     } }); 